<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Classifier</title>
    <style>
        /* Reset and Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #e3f2fd;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* Container Styling */
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
        }

        .container:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }

        /* Header Section */
        header {
            text-align: center;
            margin-bottom: 25px;
        }

        header h1 {
            font-size: 2.5rem;
            color: #1976d2;
            text-transform: uppercase;
            font-weight: bold;
        }

        header p {
            color: #555;
            font-size: 1.1rem;
        }

        /* Upload Section */
        .upload-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .upload-label {
            background-color: #42a5f5;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }

        .upload-label:hover {
            background-color: #1e88e5;
        }

        #fileInput {
            display: none;
        }

        .submit-button {
            background-color: #4caf50;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 10px;
            transition: background-color 0.3s ease;
        }

        .submit-button:hover {
            background-color: #388e3c;
        }

        /* Preview Image Styling */
        .preview-image {
            max-width: 150px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 3px solid #42a5f5;
        }

        /* Result Section */
        .result-section {
            text-align: center;
            margin-top: 20px;
        }

        .result-section h2 {
            font-size: 2rem;
            color: #333;
            margin-bottom: 15px;
        }

        #uploadedImage {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        #predictionResult {
            font-size: 1.4rem;
            color: #333;
            font-weight: bold;
        }

        /* Camera Section Styling */
        .camera-section {
            text-align: center;
            margin-top: 30px;
        }

        .camera-button {
            background-color: #42a5f5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s ease;
        }

        .camera-button:hover {
            background-color: #1e88e5;
        }

        .camera-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        #video,
        #canvas {
            border: 3px solid #42a5f5;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        /* Bin Display */
        .bin-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .bin {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .bin img {
            max-width: 100px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .bin p {
            margin-top: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        /* Mobile Responsiveness */
        @media only screen and (max-width: 600px) {
            .container {
                padding: 15px;
            }

            header h1 {
                font-size: 1.8rem;
            }

            header p {
                font-size: 1rem;
            }

            .submit-button,
            .camera-button {
                font-size: 0.9rem;
            }
        }

        /* Result Section */
        .result-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #f9f9f9;
        }

        .result-section h2 {
            font-size: 2rem;
            color: #1976d2;
            margin-bottom: 20px;
            font-weight: bold;
        }

        #uploadedImage {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        #predictionResult {
            font-size: 1.3rem;
            color: #333;
            font-weight: bold;
            margin-bottom: 20px;
        }

        /* Button Styling */
        .result-section .submit-button {
            width: 180px;
            margin: 10px 5px;
            font-size: 1.1rem;
        }

        /* Creativity Section */
        .creativity-section {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .creativity-section h3 {
            color: #388e3c;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .creativity-section ul {
            list-style: none;
            padding: 0;
        }

        .creativity-section li {
            padding: 8px;
            font-size: 1.1rem;
            color: #333;
            border-bottom: 1px solid #ddd;
        }

        /* Bin Container Styling */
        .bin-container {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
        }

        .bin {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .bin h4 {
            font-size: 1.2rem;
            color: #1976d2;
            margin-bottom: 10px;
        }

        .bin img {
            max-width: 80px;
            height: auto;
            border-radius: 8px;
            margin-bottom: 5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .bin p {
            font-size: 1.1rem;
            color: #333;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>AI Image Classifier</h1>
            <p>Upload an image to classify its category with AI-powered predictions!</p>
        </header>

        <section class="upload-section">
            <img id="imagePreview" class="preview-image" src="" alt="Preview" style="display:none;">
            <form id="uploadForm" enctype="multipart/form-data">
                <label for="fileInput" class="upload-label">Choose an Image</label>
                <input type="file" id="fileInput" name="file" accept="image/*" required>
                <button type="submit" class="submit-button">Predict</button>
            </form>
        </section>

        <!-- Camera Capture Section -->
        <section class="camera-section">
            <h2>Or Capture Live Photo</h2>
            <button id="startCamera" class="camera-button">Start Camera</button>
            <div class="camera-container">
                <video id="video" width="300" height="200" autoplay style="display:none;"></video>
                <canvas id="canvas" width="300" height="200" style="display:none;"></canvas>
                <button id="capture" class="camera-button" style="display:none;">Capture Photo</button>
                <button id="predictCamera" class="camera-button" style="display:none;">Predict from Camera</button>
            </div>
        </section>

        <!-- Prediction Result Section -->
        <section class="result-section" id="resm" hidden>
            <h2>Prediction Result</h2>
            <div id="resultContainer">
                <img id="uploadedImage" src="" alt="Uploaded Image" style="display: none;">
                <p id="predictionResult"></p>
            </div>
            <button id="recycle" type="button" class="submit-button">Want to dump?</button>
            <button id="creativity" type="button" class="submit-button">Want to do any creativity?</button>
            <button id="ytlink" type="button" class="submit-button" hidden>art and craft youtube links</button>

            <div id="creativitySuggestions" class="creativity-section" hidden>
                <h3>Creative Ideas for Reuse</h3>
                <ul id="suggestionList"></ul>
            </div>

            <div id="ytSuggestions" class="creativity-section" hidden>
                <h3>Youtube links</h3>
                <ul id="ytList"></ul>
            </div>

            <!-- Bin Section -->
            <div class="bin-container" id="binimg" hidden>
                <div class="bin" id="recycleBin">
                    <h4>Put inside</h4>
                    <img src="{{ url_for('static', filename='images/recycle_bin.jpg') }}" alt="Recycle Bin">
                    <p>Recycle Bin</p>
                </div>
                <div class="bin" id="hazardousBin">
                    <h4>Put inside</h4>
                    <img src="{{ url_for('static', filename='images/hazardous_bin.jpg') }}" alt="Hazardous Bin">
                    <p>Hazardous Bin</p>
                </div>
                <div class="bin" id="foodWasteBin">
                    <h4>Put inside</h4>
                    <img src="{{ url_for('static', filename='images/food_waste_bin.jpg') }}" alt="Food Waste Bin">
                    <p>Food Waste Bin</p>
                </div>
            </div>

            <script>
                // Handling file upload and preview
                const fileInput = document.getElementById('fileInput');
                const imagePreview = document.getElementById('imagePreview');
                const uploadForm = document.getElementById('uploadForm');
                const uploadedImage = document.getElementById('uploadedImage');
                const predictionResult = document.getElementById('predictionResult');
                const binContainer = document.getElementById('binimg');
                const recycleBin = document.getElementById('recycleBin');
                const hazardousBin = document.getElementById('hazardousBin');
                const foodWasteBin = document.getElementById('foodWasteBin');
                const creativityButton = document.getElementById('creativity');
                const creativitySuggestions = document.getElementById('creativitySuggestions');
                const suggestionList = document.getElementById('suggestionList');
                const ytlink = document.getElementById("ytlink");

                fileInput.addEventListener('change', () => {
                    const file = fileInput.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            imagePreview.src = e.target.result;
                            imagePreview.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });

                uploadForm.addEventListener('submit', async (event) => {
                    event.preventDefault();
                    const formData = new FormData(uploadForm);
                    const response = await fetch('/predict', {
                        method: 'POST',
                        body: formData
                    });
                    const data = await response.json();
                    displayPrediction(data);
                });

                function displayPrediction(data) {
                    const resm = document.getElementById('resm');
                    resm.removeAttribute('hidden');

                    // Show the uploaded image
                    uploadedImage.src = imagePreview.src; // Use the preview image source
                    uploadedImage.style.display = 'block';

                    // Display the prediction result
                    predictionResult.textContent = data.result;

                    // Show the correct bin section based on the prediction
                    binContainer.removeAttribute('hidden');

                    // Set up waste categorization
                    const recycle_bin = document.getElementById('recycle');
                    recycle_bin.addEventListener('click', async (event) => {
                        event.preventDefault();
                        creativityButton.hidden = true;

                        const wasteType = data.result.split(' ')[2].toLowerCase(); // Extract waste type
                        // Hide all bins initially
                        recycleBin.style.display = 'none';
                        hazardousBin.style.display = 'none';
                        foodWasteBin.style.display = 'none';

                        // Show the appropriate bin based on waste type
                        const recyclableItems = ["metal", "paper", "plastic", "glass", "cardboard"];
                        if (recyclableItems.includes(wasteType)) {
                            recycleBin.style.display = 'flex';
                        } else if (wasteType === "battery") {
                            hazardousBin.style.display = 'flex';
                        } else if (wasteType === "food_waste") {
                            foodWasteBin.style.display = 'flex';
                        }
                    });
                }

                // Camera capture functionality
                const startCameraButton = document.getElementById('startCamera');
                const video = document.getElementById('video');
                const canvas = document.getElementById('canvas');
                const captureButton = document.getElementById('capture');
                const predictCameraButton = document.getElementById('predictCamera');

                // Start the camera when the start button is clicked
                startCameraButton.addEventListener('click', async () => {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                        video.srcObject = stream;
                        video.style.display = 'block';
                        captureButton.style.display = 'inline-block';
                        predictCameraButton.style.display = 'inline-block';
                    } catch (error) {
                        console.error('Error accessing camera:', error);
                    }
                });

                // Capture image from video stream and display on canvas
                captureButton.addEventListener('click', () => {
                    const context = canvas.getContext('2d');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    canvas.style.display = 'block';
                    video.style.display = 'none';  // Hide the video after capture
                });

                // Handle prediction from camera image
                predictCameraButton.addEventListener('click', async () => {
                    // Convert canvas image to blob
                    const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg'));

                    // Display the captured image in the uploadedImage element
                    uploadedImage.src = canvas.toDataURL('image/jpeg');
                    uploadedImage.style.display = 'block';

                    // Send image blob to server for prediction
                    const formData = new FormData();
                    formData.append('file', blob, 'capture.jpg');

                    try {
                        const response = await fetch('/predict', {
                            method: 'POST',
                            body: formData
                        });
                        const data = await response.json();

                        // Display prediction result
                        displayPrediction(data);
                    } catch (error) {
                        console.error('Error during prediction:', error);
                    }
                });

                // Fetch creativity ideas dynamically
                creativityButton.addEventListener('click', async () => {
                    const wasteType = predictionResult.textContent.split(' ')[2].toLowerCase();
                    console.log("Sending waste type to backend:", wasteType);
                    ytlink.removeAttribute('hidden');
                    try {
                        const response = await fetch('/suggestions', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ wasteType: wasteType }) // Corrected key
                        });
                        console.log("Received response:", response);

                        const data = await response.json();
                        console.log("Generated ideas:", data);

                        if (data.ideas) {
                            const ideas = data.ideas.split('\n');
                            suggestionList.innerHTML = '';
                            ideas.forEach(idea => {
                                const li = document.createElement('li');
                                li.textContent = idea;
                                suggestionList.appendChild(li);
                            });
                            ytSuggestions.setAttribute('hidden', '');
                            creativitySuggestions.removeAttribute('hidden');
                        } else {
                            console.error("No ideas found in response.");
                        }
                    } catch (error) {
                        console.error("Error during suggestion generation:", error);
                    }
                });
                ytlink.addEventListener('click', async () => {
                    const wasteType = predictionResult.textContent.split(' ')[2].toLowerCase();
                    console.log("Sending waste type to backend:", wasteType);
                    ytlink.removeAttribute('hidden');
                    try {
                        const response = await fetch('/ytsuggestions', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ wasteType: wasteType }) // Corrected key
                        });
                        console.log("Received response:", response);

                        const data = await response.json();
                        console.log("Generated links:", data);

                        if (data.links) { // Use 'data.links' to access the links
                            const links = data.links.split('\n');
                            ytList.innerHTML = '';
                            links.forEach(link => {
                                const li = document.createElement('li');
                                const a = document.createElement('a'); // Create an anchor element
                                a.href = link; // Set the href to the link
                                a.textContent = link; // Set the link text
                                a.target = '_blank'; // Open in a new tab
                                a.rel = 'noopener noreferrer'; // Add security attributes
                                li.appendChild(a); // Append the anchor to the list item
                                ytList.appendChild(li); // Append the list item to the list
                            });
                            creativitySuggestions.setAttribute('hidden', '');
                            ytSuggestions.removeAttribute('hidden');
                        } else {
                            console.error("No links found in response.");
                        }
                    } catch (error) {
                        console.error("Error during suggestion generation:", error);
                    }
                });



            </script>


</body>

</html>